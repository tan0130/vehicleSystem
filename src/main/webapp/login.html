<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>后台管理</title>
    <link rel="stylesheet" href="resources/css/login1.css" />
    <script type="text/javascript" src="resources/js/jquery.min.js"></script>
    <script type="text/javascript" src="resources/js/jquery.validate.js"></script>
</head>

<body>
<div class="login_box">
    <div class="login_l_img"><img src="/resources/img/login-img.png" /></div>
    <div class="login">
        <div class="login_logo"><a href="#"><img src="/resources/img/login_logo.png" /></a></div>
        <div class="login_name">
            <p>后台管理系统</p>
        </div>
        <form id="sign" method="post">
            <input name="username" type="text" id="userId"  value="用户名" >
            <!--<span id="password_text" onclick="this.style.display='none';document.getElementById('password').style.display='block';document.getElementById('password').focus().select();" >密码</span>-->
            <input name="password" type="password" id="userPwd" value="密码"/>
            <input value="登录" style="width:100%;" type="submit">
        </form>
    </div>
    <div class="copyright">某某有限公司 版权所有©2016-2018 技术支持电话：000-00000000</div>
</div>
<div style="text-align:center;">
    <p>更多模板：<a href="http://www.mycodes.net/" target="_blank">源码之家</a></p>
</div>
<script type="text/javascript">
    $.validator.addMethod('idCheck', function(value, element) {
        var userid = $('#userId').val();
        /*if (flag) {
            return;
        }
        flag = true;*/
        $.ajax({ // 进入ajax提交过程
            type: 'get',
            async: false,
            url: '/login/getUserById',
            dataType: 'text',
            data: {
                id: userid
            },
            success: function(data) {
                if(data == "false") {
                    value = false;
                } else if(data == "false") {
                    $.messager.alert('信息提示', '服务不可用', 'info');
                } else {
                    value = true;
                }
                // flag = false; // 标记为可提交状态
            },
            error: function(data) {
                // flag = false;
                $.messager.alert('信息提示', '服务不可用!', 'info');
            }
        });
        return this.optional(element) || value;
    }, '用户不存在');
    // 自定义校验密码是否正确
    $.validator.addMethod('pwdCheck', function(value, element) {
        var userid = $('#userId').val();
        var userpwd = $('#userPwd').val();
        $.ajax({
            type: 'get',
            async: false,
            cache: false,
            url: '/login/getUserByIdAndPwd',
            data: {
                id: userid,
                password: userpwd
            },
            success: function(data) {
                if(data == "false") {
                    value = false;
                } else if(data == "error") {
                    $.messager.alert('信息提示', '服务不可用', 'info');
                } else {
                    value = true;
                }
            },
            error: function() {
                $.messager.alert('信息提示', '服务不可用', 'info');
            }
        });
        return this.optional(element) || value;
    }, '密码不正确');
    $().ready(function(){
        $('#sign').validate({
            rules: {
                userId: {
                    required: true,
                    idCheck: true
                },
                userPwd: {
                    required: true,
                    pwdCheck: true
                }
            },
            messages: {
                userId: {
                    required: "该项为必填项",
                    idCheck: "用户不存在"
                },
                userPwd: {
                    required: "该项为必填项",
                    pwdCheck: "密码不正确"
                }
            },
            submitHandler: function() {
                //var id = $('#userId').val();
                window.location.href = "/login/toPage";
            }
        })
    })
</script>
</body>
</html>
